{
  "$schema": "https://vega.github.io/schema/vega/v5.json",
  "width": 200, "height": 150,
  "data": [
    {
      "name": "results",
      "url": {
        "%context%": false,
        "index": "wazuh-explain-v1",
        "body": {
          "size": 1,
          "sort": [ { "timestamp": { "order": "desc" } } ],
          "_source": ["predicted_score", "predicted_label"]
        }
      },
      "format": { "property": "hits.hits" }
    }
  ],
  "signals": [
    {
      "name": "score", 
      "update": "length(data('results')) > 0 ? data('results')[0]._source.predicted_score : 0"
    },
    {
      "name": "label",
      "update": "length(data('results')) > 0 ? data('results')[0]._source.predicted_label : 'N/A'"
    }
  ],
  "marks": [
    {
      "type": "arc",
      "encode": {
        "enter": {
          "x": {"value": 100}, "y": {"value": 100},
          "innerRadius": {"value": 50}, "outerRadius": {"value": 80},
          "startAngle": {"value": -1.57}, "endAngle": {"value": 1.57},
          "fill": {"value": "#e5e7eb"}
        }
      }
    },
    {
      "type": "arc",
      "encode": {
        "enter": {
          "x": {"value": 100}, "y": {"value": 100},
          "innerRadius": {"value": 50}, "outerRadius": {"value": 80},
          "startAngle": {"value": -1.57},
          "fill": [
             {"test": "score < 0.5", "value": "#16a34a"},
             {"value": "#dc2626"}
          ]
        },
        "update": {
          "endAngle": {"signal": "-1.57 + (score * 3.14)"}
        }
      }
    },
    {
      "type": "text",
      "encode": {
        "enter": {
          "x": {"value": 100}, "y": {"value": 90},
          "align": {"value": "center"},
          "fontSize": {"value": 20}, "fontWeight": {"value": "bold"}, "fill": {"value": "#333"}
        },
        "update": { "text": {"signal": "format(score, '.4f')"} }
      }
    },
    {
      "type": "text",
      "encode": {
        "enter": {
          "x": {"value": 100}, "y": {"value": 115},
          "align": {"value": "center"},
          "fontSize": {"value": 14}, "fill": {"value": "#666"}
        },
        "update": { "text": {"signal": "label"} }
      }
    }
  ]
}